<%- include('partials/header', { title: 'Sources' }) %>

<h1>RSS Feed Sources</h1>

<div class="card" style="overflow-x:auto">
  <table>
    <tr>
      <th>Source</th>
      <th>Status</th>
      <th>Last Fetch</th>
      <th>Errors</th>
      <th>Last Error</th>
      <th>Total Items</th>
      <th>New Items</th>
      <th>DB Events</th>
    </tr>
    <% feeds.forEach(feed => { %>
      <tr>
        <td>
          <strong><%= feed.name %></strong>
          <% if (!feed.enabled) { %><span class="badge badge-gray" style="margin-left:6px">disabled</span><% } %>
        </td>
        <td>
          <% if (!feed.enabled) { %>
            <span class="badge badge-gray">OFF</span>
          <% } else if (feed.stats.lastSuccess) { %>
            <span class="badge badge-green">OK</span>
          <% } else if (feed.stats.lastError) { %>
            <span class="badge badge-red">ERROR</span>
          <% } else { %>
            <span class="badge badge-yellow">PENDING</span>
          <% } %>
        </td>
        <td class="text-sm text-muted">
          <%= feed.stats.lastFetchTime ? new Date(feed.stats.lastFetchTime).toLocaleString('en-US', { month:'short', day:'numeric', hour:'2-digit', minute:'2-digit', second:'2-digit' }) : '—' %>
        </td>
        <td>
          <% if (feed.stats.errorCount > 0) { %>
            <span class="badge badge-red"><%= feed.stats.errorCount %></span>
          <% } else { %>
            <span class="text-muted">0</span>
          <% } %>
        </td>
        <td class="text-sm truncate" style="max-width:250px"><%= feed.stats.lastError || '—' %></td>
        <td><%= feed.stats.itemsTotal %></td>
        <td><%= feed.stats.itemsNew %></td>
        <td><%= sourceMap[feed.name] || 0 %></td>
      </tr>
    <% }) %>
  </table>
</div>

<div class="card" style="margin-top:8px">
  <h2>Feed URLs</h2>
  <table>
    <tr><th>Source</th><th>URL</th></tr>
    <% feeds.forEach(feed => { %>
      <tr>
        <td><%= feed.name %></td>
        <td class="text-sm text-muted"><%= feed.url %></td>
      </tr>
    <% }) %>
  </table>
</div>

<%- include('partials/footer') %>
